<html>
<head>
<meta charset="utf-8"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<style type="text/tailwindcss">
      :root {
        --background: 210 20% 98%;
        --foreground: 210 20% 3%;
        --card: 0 0% 100%;
        --card-foreground: 210 20% 3%;
        --popover: 0 0% 100%;
        --popover-foreground: 210 20% 3%;
        --primary: 210 40% 98%;
        --primary-foreground: 210 40% 9%;
        --secondary: 210 20% 96%;
        --secondary-foreground: 210 20% 9%;
        --muted: 210 20% 96%;
        --muted-foreground: 210 20% 38%;
        --accent: 210 20% 96%;
        --accent-foreground: 210 20% 9%;
        --destructive: 0 84.2% 60.2%;
        --destructive-foreground: 210 20% 98%;
        --border: 210 20% 88%;
        --input: 210 20% 88%;
        --ring: 210 20% 3%;
      }
      .dark {
        --background: 224 20% 5%;
        --foreground: 210 20% 98%;
        --card: 224 20% 5%;
        --card-foreground: 210 20% 98%;
        --popover: 224 20% 5%;
        --popover-foreground: 210 20% 98%;
        --primary: 210 40% 9%;
        --primary-foreground: 210 40% 98%;
        --secondary: 210 20% 12%;
        --secondary-foreground: 210 20% 98%;
        --muted: 210 20% 12%;
        --muted-foreground: 210 20% 60%;
        --accent: 210 20% 12%;
        --accent-foreground: 210 20% 98%;
        --destructive: 0 62.8% 30.6%;
        --destructive-foreground: 210 20% 98%;
        --border: 210 20% 12%;
        --input: 210 20% 12%;
        --ring: 210 20% 98%;
      }
      body {
        background: linear-gradient(180deg, #0d1b2a 0%, #1b263b 100%);
        color: #e0e1dd;
      }
      .typing-indicator {
        display: inline-flex;
        align-items: center;
      }
      .typing-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background-color: #9ca3af;
        margin: 0 2px;
        animation: typing 1.4s infinite ease-in-out;
      }
      .typing-dot:nth-child(1) { animation-delay: 0s; }
      .typing-dot:nth-child(2) { animation-delay: 0.2s; }
      .typing-dot:nth-child(3) { animation-delay: 0.4s; }
      @keyframes typing {
        0%, 60%, 100% { transform: translateY(0); }
        30% { transform: translateY(-5px); }
      }
    </style>
</head>
<body class="font-sans">
<div class="flex h-screen w-full min-h-screen">
<aside class="flex w-80 flex-col border-r border-slate-800 bg-[#0d1b2a]/50 p-4 space-y-4">
<div class="flex items-center justify-between">
<h1 class="text-xl font-bold text-teal-400">BlackPearl AI</h1>
<button class="rounded-full p-2 hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-teal-400 focus:ring-opacity-50">
<span class="material-symbols-outlined text-teal-300"> settings </span>
</button>
</div>
<div class="relative">
<span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"> search </span>
<input class="w-full rounded-lg border border-slate-700 bg-slate-900 py-2 pl-10 pr-4 text-white placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="Search"/>
</div>
<button id="newChatBtn" class="flex w-full items-center justify-center gap-2 rounded-lg bg-teal-500 py-2.5 font-semibold text-slate-900 shadow-lg shadow-teal-500/10 transition-all hover:bg-teal-400 focus:outline-none focus:ring-2 focus:ring-teal-400 focus:ring-offset-2 focus:ring-offset-slate-900">
<span class="material-symbols-outlined"> add </span>
          New Chat
        </button>
<div class="flex-1 overflow-y-auto">
<h3 class="px-2 text-sm font-semibold text-slate-400">Past Chats</h3>
<nav id="chatHistory" class="mt-2 space-y-1">
<a class="group flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-300 hover:bg-slate-800 hover:text-white" href="#"><span class="truncate">Chat 1: Ocean currents</span></a>
<a class="group flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-300 hover:bg-slate-800 hover:text-white" href="#"><span class="truncate">Chat 2: Marine life</span></a>
<a class="group flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-300 hover:bg-slate-800 hover:text-white" href="#"><span class="truncate">Chat 3: Coral reefs</span></a>
<a class="group flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-300 hover:bg-slate-800 hover:text-white" href="#"><span class="truncate">Chat 4: Deep sea</span></a>
<a class="group flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-300 hover:bg-slate-800 hover:text-white" href="#"><span class="truncate">Chat 5: Ocean pollution</span></a>
<a class="group flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-300 hover:bg-slate-800 hover:text-white" href="#"><span class="truncate">Chat 6: Ocean conservation</span></a>
<a class="group flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-300 hover:bg-slate-800 hover:text-white" href="#"><span class="truncate">Chat 7: Ocean exploration</span></a>
<a class="group flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-300 hover:bg-slate-800 hover:text-white" href="#"><span class="truncate">Chat 8: Oceanography</span></a>
<a class="group flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-300 hover:bg-slate-800 hover:text-white" href="#"><span class="truncate">Chat 9: Marine biology</span></a>
<a class="group flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-300 hover:bg-slate-800 hover:text-white" href="#"><span class="truncate">Chat 10: Ocean ecosystems</span></a>
</nav>
</div>
</aside>
<main class="flex flex-1 flex-col p-6">
<div id="chatContainer" class="flex-1 overflow-y-auto pr-4">
<div class="space-y-8">
<div class="flex items-start gap-4">
<!-- <div class="flex h-10 w-10 items-center justify-center rounded-full bg-slate-700 font-bold text-white">U</div>
<div class="flex-1 rounded-lg bg-slate-800/60 p-4">
<p class="text-white">Show me salinity profile near the equator in March 2023</p>
</div> -->
</div>
<div class="flex items-start gap-4">
<div class="">
<!-- <span class="material-symbols-outlined text-2xl">science</span> -->
</div>
<div class="">
<!-- <p class="text-slate-300">Certainly. Here is the salinity profile near the equator for March 2023. The data indicates a significant freshwater lens, likely due to increased precipitation from the Intertropical Convergence Zone (ITCZ) during this period.</p> -->
<div class="overflow-x-auto rounded-lg border border-slate-700 bg-slate-900/50">
<!-- <table class="min-w-full divide-y divide-slate-700 text-sm">
<thead class="bg-slate-800/80">
<tr>
<th class="px-4 py-2 text-left font-semibold text-teal-400" scope="col">Depth (m)</th>
<th class="px-4 py-2 text-left font-semibold text-teal-400" scope="col">Salinity (PSU)</th>
<th class="px-4 py-2 text-left font-semibold text-teal-400" scope="col">Temperature (°C)</th>
<th class="px-4 py-2 text-left font-semibold text-teal-400" scope="col">Longitude</th>
<th class="px-4 py-2 text-left font-semibold text-teal-400" scope="col">Latitude</th>
</tr>
</thead>
<tbody class="divide-y divide-slate-800">
<tr>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">0</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">34.5</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">28.2</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">150.1°W</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">0.5°N</td>
</tr>
<tr>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">10</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">34.6</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">28.1</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">150.1°W</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">0.5°N</td>
</tr>
<tr>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">20</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">34.8</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">27.9</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">150.1°W</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">0.5°N</td>
</tr>
<tr>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">50</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">35.1</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">27.5</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">150.1°W</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">0.5°N</td>
</tr>
<tr>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">100</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">35.2</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">26.8</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">150.1°W</td>
<td class="whitespace-nowrap px-4 py-2 text-slate-300">0.5°N</td>
</tr>
</tbody>
</table> -->
</div>
</div>
</div>
</div>
</div>
<div class="mt-auto pt-4">
<div class="relative">
<textarea id="userInput" class="w-full resize-none rounded-full border border-slate-700 bg-slate-900/80 py-3 pl-6 pr-28 text-white placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="Type your query here..." rows="1"></textarea>
<div class="absolute bottom-1.5 right-1.5 flex items-center gap-1">
<button class="rounded-full p-2 hover:bg-slate-700/80 focus:outline-none focus:ring-2 focus:ring-teal-400 focus:ring-opacity-50">
<span class="material-symbols-outlined text-slate-400">mic</span>
</button>
<button id="sendButton" class="rounded-full bg-teal-500 p-2 text-slate-900 shadow-md transition-colors hover:bg-teal-400 focus:outline-none focus:ring-2 focus:ring-teal-400 focus:ring-offset-2 focus:ring-offset-slate-900">
<span class="material-symbols-outlined">send</span>
</button>
</div>
</div>
</div>
</main>
<aside class="flex w-64 flex-col border-l border-slate-800 bg-[#0d1b2a]/50 p-4 space-y-6">
<div>
<h3 class="text-sm font-semibold uppercase tracking-wider text-slate-400">Data</h3>
<div class="mt-2 space-y-2">
<button class="group flex w-full flex-col items-center rounded-lg border border-dashed border-slate-700 bg-slate-900/50 p-3 text-center transition-all hover:border-teal-500 hover:bg-slate-800">
<span class="material-symbols-outlined text-3xl text-slate-500 group-hover:text-teal-400"> upload_file </span>
<span class="mt-1 text-sm font-medium text-slate-300">Upload Data</span>
</button>
</div>
</div>
<div>
<h3 class="text-sm font-semibold uppercase tracking-wider text-slate-400">Analysis</h3>
<div class="mt-2 grid grid-cols-2 gap-2">
<button class="group flex flex-col items-center rounded-lg bg-slate-800/50 p-3 text-center transition-all hover:bg-slate-700/80 focus:outline-none focus:ring-2 focus:ring-teal-400 focus:ring-opacity-50">
<span class="material-symbols-outlined text-3xl text-slate-400 group-hover:text-teal-300"> auto_graph </span>
<span class="mt-1 text-sm font-medium text-slate-300">Visualize</span>
</button>
<button class="group flex flex-col items-center rounded-lg bg-slate-800/50 p-3 text-center transition-all hover:bg-slate-700/80 focus:outline-none focus:ring-2 focus:ring-teal-400 focus:ring-opacity-50">
<span class="material-symbols-outlined text-3xl text-slate-400 group-hover:text-teal-300"> biotech </span>
<span class="mt-1 text-sm font-medium text-slate-300">Analyze</span>
</button>
</div>
</div>
<div>
<h3 class="text-sm font-semibold uppercase tracking-wider text-slate-400">Export</h3>
<div class="mt-2 space-y-2">
<button class="group flex w-full items-center justify-center gap-2 rounded-lg bg-slate-800/50 p-3 text-center transition-all hover:bg-slate-700/80 focus:outline-none focus:ring-2 focus:ring-teal-400 focus:ring-opacity-50">
<span class="material-symbols-outlined text-slate-400 group-hover:text-teal-300"> download </span>
<span class="text-sm font-medium text-slate-300">Export Results</span>
</button>
</div>
</div>
</aside>
</div>

<script>
// Configuration - Replace with your actual N8N webhook URL
const N8N_WEBHOOK_URL = 'http://localhost:5678/webhook-test/7f74147d-cc07-4f9c-be64-c47d042ef8ab';

// DOM Elements
const userInput = document.getElementById('userInput');
const sendButton = document.getElementById('sendButton');
const chatContainer = document.getElementById('chatContainer');
const newChatBtn = document.getElementById('newChatBtn');

// State management
let currentChat = [];
let isWaitingForResponse = false;

// Function to handle user input
async function handleUserInput() {
    const userText = userInput.value.trim();
    
    if (!userText || isWaitingForResponse) return;
    
    // Clear input field
    userInput.value = '';
    
    // Add user message to chat
    addUserMessage(userText);
    
    // Show typing indicator
    showTypingIndicator();
    
    // Send to N8N
    try {
        const response = await sendToN8N(userText);
        // Remove typing indicator
        removeTypingIndicator();
        // Add AI response to chat
        addAiMessage(response);
    } catch (error) {
        // Remove typing indicator
        removeTypingIndicator();
        // Show error message
        addAiMessage("Sorry, I'm having trouble connecting to the server. Please try again later.");
        console.error("Error:", error);
    }
}

// Function to send message to N8N
async function sendToN8N(message) {
    isWaitingForResponse = true;
    
    try {
        const response = await fetch(N8N_WEBHOOK_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                message: message,
                timestamp: new Date().toISOString()
            })
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        isWaitingForResponse = false;
        return data.response || "I received your message but didn't get a proper response from the server.";
    } catch (error) {
        isWaitingForResponse = false;
        throw error;
    }
}

// Function to add user message to chat
function addUserMessage(message) {
    const messageHtml = `
        <div class="flex items-start gap-4">
            <div class="flex h-10 w-10 items-center justify-center rounded-full bg-slate-700 font-bold text-white">U</div>
            <div class="flex-1 rounded-lg bg-slate-800/60 p-4">
                <p class="text-white">${message}</p>
            </div>
        </div>
    `;
    
    chatContainer.innerHTML += messageHtml;
    scrollToBottom();
    
    // Save to current chat
    currentChat.push({ type: 'user', content: message });
}

// Function to add AI message to chat
function addAiMessage(message) {
    const messageHtml = `
        <div class="flex items-start gap-4">
            <div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-teal-500/20 text-teal-400">
                <span class="material-symbols-outlined text-2xl">science</span>
            </div>
            <div class="flex-1 rounded-lg bg-slate-800/60 p-4">
                <p class="text-slate-300">${message}</p>
            </div>
        </div>
    `;
    
    chatContainer.innerHTML += messageHtml;
    scrollToBottom();
    
    // Save to current chat
    currentChat.push({ type: 'ai', content: message });
}

// Function to show typing indicator
function showTypingIndicator() {
    const typingHtml = `
        <div class="flex items-start gap-4 typing-indicator-container">
            <div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-teal-500/20 text-teal-400">
                <span class="material-symbols-outlined text-2xl">science</span>
            </div>
            <div class="flex-1 rounded-lg bg-slate-800/60 p-4">
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
        </div>
    `;
    
    chatContainer.innerHTML += typingHtml;
    scrollToBottom();
}

// Function to remove typing indicator
function removeTypingIndicator() {
    const typingIndicator = document.querySelector('.typing-indicator-container');
    if (typingIndicator) {
        typingIndicator.remove();
    }
}

// Function to scroll to bottom of chat
function scrollToBottom() {
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Function to start a new chat
function startNewChat() {
    currentChat = [];
    chatContainer.innerHTML = '';
    userInput.value = '';
}

// Event listeners
sendButton.addEventListener('click', handleUserInput);
userInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        handleUserInput();
    }
});
newChatBtn.addEventListener('click', startNewChat);

// Auto-resize textarea
userInput.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight) + 'px';
});
</script>
</body>
</html>